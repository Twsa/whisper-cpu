# Whisper to LRC 转换器

使用 faster_whisper 将音频文件转换为带时间戳的 LRC 字幕文件。

## 功能特点

- 使用 faster_whisper 进行高精度语音识别
- 生成标准 LRC 格式时间戳 [mm:ss.xx]
- 支持单文件转换和递归批处理
- 支持多种音频格式（mp3, wav, m4a, flac, mp4 等）
- 支持多语言自动检测
- 可配置模型大小和计算参数
- LRC 文件保存在音频文件同级目录
- 自动跳过已存在的文件（可强制覆盖）

## 安装依赖

### 方法一：使用虚拟环境（推荐）

```bash
# 克隆项目
git clone https://github.com/Twsa/whisper-cpu
cd whisper-cpu

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
source venv/bin/activate  # Linux/macOS
# 或
venv\Scripts\activate     # Windows

# 安装依赖
pip install faster-whisper torch
```

### 方法二：直接安装依赖

不想使用虚拟环境也可以直接安装：

```bash
pip install faster-whisper torch
```

## 使用方法

### 单文件转换

```bash
# 基本使用
python main.py audio.mp3

# 指定输出文件
python main.py audio.mp3 -o output.lrc

# 使用更大的模型（更准确但更慢）
python main.py audio.mp3 -m small

# 指定语言（中文：zh，英文：en）
python main.py audio.mp3 -l zh

# 启用语音活动检测（过滤静音）
python main.py audio.mp3 --vad-filter
```

### 批处理模式

```bash
# 递归处理目录下的所有音频文件
python main.py -b /path/to/audio/directory

# 仅处理当前目录（不递归子目录）
python main.py -b /path/to/audio/directory --no-recursive

# 强制覆盖已存在的 LRC 文件
python main.py -b /path/to/audio/directory --force

# 批处理时指定语言
python main.py -b /path/to/audio/directory -l zh

# 使用 tiny 模型快速批处理
python main.py -b /path/to/audio/directory -m tiny
```

### 参数说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `-b, --batch` | 批处理模式：指定目录路径 | - |
| `-o, --output` | 单文件模式：输出文件路径 | 输入文件同目录 |
| `-m, --model` | 模型大小 (tiny/base/small/medium/large) | base |
| `-l, --language` | 语言代码 | 自动检测 |
| `--beam-size` | Beam search 大小 | 5 |
| `--device` | 计算设备 (cpu/cuda) | cpu |
| `--compute-type` | 计算类型 (int8/float16/float32) | int8 |
| `--vad-filter` | 启用语音活动检测 | False |
| `--no-recursive` | 批处理模式：不递归子目录 | False |
| `--force` | 批处理模式：强制覆盖已存在的文件 | False |

## 输出格式

生成的 LRC 文件格式示例：

```
[ar:Generated by faster-whisper]
[al:audio.mp3]
[re:Whisper base model]

[00:00.00]这是第一句话
[00:05.23]这是第二句话
[00:10.47]这是第三句话
```

## 示例

### 单文件转换

```bash
python main.py 01.Test1.Section1.mp3 -o output/01.Test1.Section1.lrc
```

输出文件将保存在 `output/` 目录中。

### 批处理示例

假设有以下目录结构：
```
music/
├── song1.mp3
├── song2.wav
└── albums/
    ├── album1/
    │   ├── track1.mp3
    │   └── track2.flac
    └── album2/
        └── track3.m4a
```

批处理命令：
```bash
# 递归处理所有音频文件，生成 LRC 在原目录
python main.py -b music/

# 处理结果
music/
├── song1.lrc
├── song1.mp3
├── song2.lrc
├── song2.wav
└── albums/
    ├── album1/
    │   ├── track1.lrc
    │   ├── track1.mp3
    │   ├── track2.flac
    │   └── track2.lrc
    └── album2/
        ├── track3.lrc
        └── track3.m4a
```